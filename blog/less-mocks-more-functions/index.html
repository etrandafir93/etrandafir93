<!doctype html>
<html lang="en">

<head>
        <title>Less Mocks, More Functions! - Emanuel Trandafir</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="../../assets/css/darcula-highlight.min.css">

        <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../assets/css/dracula-ui.min.css">
        <link rel="stylesheet" href="../../assets/css/mkdocs.min.css">
            <link href="../../stylesheets/extra.css" rel="stylesheet">

        
            <link  rel="icon" type="image/x-icon" href="../../img/me.jpeg">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        
            <img class="logo" src="../../img/me.jpeg" height="150px">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">Emanuel Trandafir</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    --- About Me ---
                </a>
            </li>
            <li class="drac-box">
                <a href="../tidy-first-commitments/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    'Tidy First?' and my Post-Reading Commitments
                </a>
            </li>
            <li class="drac-box">
                <a href="../clojure-threading/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Clojure Threading for Dummy Java Devs (such as myself)
                </a>
            </li>
            <li class="drac-box">
                <a href="./"
                    class=" active 
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Less Mocks, More Functions!
                </a>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple">
        <div class="container-fluid">
            
            <button class="navbar-toggler w-100 text-center" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav text-md-center">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../clojure-threading/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a 
                        class="btn-preview drac-btn drac-text-white--hover disabled" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <section class="p-md-5 section-content">
    <article>
        <p><h1 id="less-mocks-more-functions">Less Mocks, More Functions!</h1>
<p><em>Published: September 28, 2025</em></p>
<p><code>#functional programming</code> <code>#design</code> <code>#testing</code> <code>#java</code></p>
<p>After <a href="/blog/clojure-threading/">playing with Clojure</a>, I was amazed by 
how testable everything is in the functional world.</p>
<p>In this article, we'll explore a technique that uses functional interfaces 
to reduce the number of mocks needed for testing.</p>
<p><img alt="img" src="../../img/less_mocks_meme.png" /></p>
<p>I started thinking about incorporating some functional techniques into 
my Java development work - without shaking up the codebase too much 
or becoming <em>"that functional programming person"</em> colleagues avoid at the water cooler.</p>
<p>The main idea is simple: <strong>extract dependencies that produce side effects and move them 
outside of the component you want to test</strong>.</p>
<h2 id="the-problem">The Problem</h2>
<p>This technique is particularly effective when the tested component relies on 
a dependency but utilizes only a select few of its methods, ideally just one.
We'll use Java for the code examples in the article, but the approach 
can be applied regardless of the language or testing frameworks. </p>
<p>Let's start with a typical example:</p>
<pre><code class="language-java">class AccountService {
    private final AccountRepository repository;

    AccountService(AccountRepository repository) {
        this.repository = repository;
    }

    void register(String name, String email) {
        var uuid = UUID.randomUUID();
        var account = new Account(uuid.toString(), name, email);
        // some business logic
        repository.save(account);
    }
}
</code></pre>
<p>To test this without connecting to a database, we need to mock the repository:</p>
<pre><code class="language-java">@Test
void testWithMocks() {
    var repository = mock(AccountRepository.class);
    var service = new AccountService(repository);

    service.register(&quot;john doe&quot;, &quot;jd@yahoo.com&quot;);

    verify(repository).save(argThat(it -&gt;
        it.name().equals(&quot;john doe&quot;)
          &amp;&amp; it.email().equals(&quot;jd@yahoo.com&quot;)
          &amp;&amp; it.id() != null
    ));
}
</code></pre>
<h2 id="using-functions-for-side-effects">Using Functions for Side Effects</h2>
<p>If we think about it, we only need a mock because <em>AccountService::register</em> 
produces side effects (saving the <em>Account</em> into the database). Another obvious problem with our design is that we depend on the whole <em>AccountRepository</em>
class even though we only use its <em>save()</em> method.</p>
<p>Simply put, our class needs a function that accepts an <em>Account</em> and saves it. 
The signature of this function would be <code>(Account) -&gt; void</code>.<br />
In Java, this function is also known as <code>Consumer&lt;Account&gt;</code>.</p>
<p>So, let's change <em>AccountService</em> and make it depend on this function instead of holding the whole repository:</p>
<pre><code class="language-java">class AccountService {
    private final Consumer&lt;Account&gt; saveAccount;

    AccountService(Consumer&lt;Account&gt; saveAccount) {
        this.saveAccount = saveAccount;
    }

    // Maintain backwards compatibility
    @Autowired
    AccountService(AccountRepository repository) {
        this(repository::save);
    }

    void register(String name, String email) {
        var uuid = UUID.randomUUID();
        var account = new Account(uuid.toString(), name, email);
        // some business logic
        saveAccount.accept(account);
    }
}
</code></pre>
<h2 id="testing-becomes-fun">Testing Becomes Fun</h2>
<p>Now testing becomes much simpler:</p>
<pre><code class="language-java">@Test
void testWithLambdas() {
    List&lt;Account&gt; savedAccounts = new ArrayList&lt;&gt;();
    var service = new AccountService(savedAccounts::add);

    service.register(&quot;john doe&quot;, &quot;jd@yahoo.com&quot;);

    assertThat(savedAccounts)
      .hasSize(1).first()
      .hasFieldOrPropertyWithValue(&quot;name&quot;, &quot;john doe&quot;)
      .hasFieldOrPropertyWithValue(&quot;email&quot;, &quot;jd@yahoo.com&quot;)
      .hasFieldOrProperty(&quot;id&quot;);
}
</code></pre>
<p>Testing exceptions is equally straightforward:</p>
<pre><code class="language-java">@Test
void testWithLambdas_exceptions() {
    var service = new AccountService(__ -&gt; {
        throw new IllegalArgumentException(&quot;test exception&quot;);
    });

    assertThatThrownBy(() -&gt; service.register(&quot;john doe&quot;, &quot;jd@yahoo.com&quot;))
      .isInstanceOf(IllegalArgumentException.class);
}
</code></pre>
<h2 id="handling-static-dependencies">Handling Static Dependencies</h2>
<p>Our code still isn't "pure" because it calls <code>UUID.randomUUID()</code>. 
We can apply the same technique here by extracting the UUID generation:</p>
<pre><code class="language-java">class AccountService {
    private final Consumer&lt;Account&gt; saveAccount;
    private final Supplier&lt;UUID&gt; generateUuid;

    AccountService(Consumer&lt;Account&gt; saveAccount, Supplier&lt;UUID&gt; generateUuid) {
        this.saveAccount = saveAccount;
        this.generateUuid = generateUuid;
    }

    // Backwards compatibility
    @Autowired
    AccountService(AccountRepository repository) {
        this(repository::save, UUID::randomUUID);
    }

    void register(String name, String email) {
        var uuid = generateUuid.get();
        var account = new Account(uuid.toString(), name, email);
        // some business logic
        saveAccount.accept(account);
    }
}
</code></pre>
<p>Now our tests are completely deterministic:</p>
<pre><code class="language-java">@Test
void testWithLambdas() {
    List&lt;Account&gt; savedAccounts = new ArrayList&lt;&gt;();
    var service = new AccountService(
        savedAccounts::add,
        () -&gt; UUID.fromString(&quot;00000000-0000-0000-0000-000000000001&quot;)
    );

    service.register(&quot;john doe&quot;, &quot;jd@yahoo.com&quot;);

    assertThat(savedAccounts)
      .hasSize(1).first()
      .hasFieldOrPropertyWithValue(&quot;name&quot;, &quot;john doe&quot;)
      .hasFieldOrPropertyWithValue(&quot;email&quot;, &quot;jd@yahoo.com&quot;)
      .hasFieldOrPropertyWithValue(&quot;id&quot;, &quot;00000000-0000-0000-0000-000000000001&quot;);
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>By extracting side effects into functions, we've made our code:</p>
<p>✅ <strong>Easier to test</strong> - no mocks needed</p>
<p>✅ <strong>More focused</strong> - our components only depends on what it actually needs</p>
<p>✅ <strong>Backwards compatible</strong> - existing code continues to work</p>
<p>This technique aligns with SOLID principles (specifically Interface Segregation and Dependency Inversion)
while borrowing useful concepts from functional programming. 
The result is cleaner, more testable code that's easier to reason about.</p>
<p><img alt="img2" src="../../img/less_mocks_comparison.png" /></p></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '../..';</script>
        <script src="../../assets/js/jquery-3.3.1.slim.min.js"></script>
        <script src="../../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../../assets/js/mkdocs.js"></script>
			<script src="../../search/main.js" defer></script>

</body>

</html>