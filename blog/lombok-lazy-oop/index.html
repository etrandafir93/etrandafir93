<!doctype html>
<html lang="en">

<head>
        <title>Lombok's "Lazy" Magic and the O.O.P. Alternative - Emanuel Trandafir</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="../../assets/css/darcula-highlight.min.css">

        <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../assets/css/dracula-ui.min.css">
        <link rel="stylesheet" href="../../assets/css/mkdocs.min.css">
            <link href="../../stylesheets/extra.css" rel="stylesheet">

        
            <link  rel="icon" type="image/x-icon" href="../../img/me.jpeg">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        
            <img class="logo" src="../../img/me.jpeg" height="150px">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">Emanuel Trandafir</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    --- About Me ---
                </a>
            </li>
            <li class="drac-box">
                <a href="../micrometer-assertions-contribution/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    My First Contribution to Micrometer
                </a>
            </li>
            <li class="drac-box">
                <a href="../circular-initialization-mystery/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    The Case of the Sometimes-Null Constant
                </a>
            </li>
            <li class="drac-box">
                <a href="../avro-duplicate-class-mystery/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    The Case of the Vanishing Schema Field
                </a>
            </li>
            <li class="drac-box">
                <a href="../tidy-first-commitments/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    'Tidy First?' and my Post-Reading Commitments
                </a>
            </li>
            <li class="drac-box">
                <a href="../clojure-threading/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Clojure Threading for Dummy Java Devs (such as myself)
                </a>
            </li>
            <li class="drac-box">
                <a href="../less-mocks-more-functions/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Less Mocks, More Functions!
                </a>
            </li>
            <li class="drac-box">
                <a href="../java-optional-vs-kotlin/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Java's Optional vs Kotlin: Side by Side
                </a>
            </li>
            <li class="drac-box">
                <a href="./"
                    class=" active 
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Lombok's "Lazy" Magic and the O.O.P. Alternative
                </a>
            </li>
            <li class="drac-box">
                <a href="../clean-code-dependency-principles/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Uncle Bob's Advice on Stability and Abstractions
                </a>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple">
        <div class="container-fluid">
            
            <button class="navbar-toggler w-100 text-center" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav text-md-center">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../java-optional-vs-kotlin/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a href="../clean-code-dependency-principles/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
  
                <section class="p-md-5 section-content">
    <article>
        <p><h1 id="lomboks-lazy-magic-and-the-oop-alternative">Lombok's "Lazy" Magic and the O.O.P. Alternative</h1>
<p><em>Published: February 12, 2023</em></p>
<p><a href="/#design"><code>#design</code></a> <a href="/#oop"><code>#oop</code></a></p>
<h2 id="overview">Overview</h2>
<p>In this article, we'll tackle <strong>a widespread issue: the usage of convoluted logic in constructors</strong>. 
We'll then demonstrate how this can be remedied with Lombok's lazy loading feature. 
Lastly, we'll contrast Lombok's solution with its object-oriented programming counterpart: 
the decorator pattern.</p>
<p>For the code examples in this article, we'll use the <em>Employee</em> class that has two final fields: 
the employee name and the salary. The employee name is passed as a parameter during object construction, 
while the salary is determined through a potentially time-consuming calculation.</p>
<p>This calculation could involve a complex mathematical formula or a network call, for example:</p>
<pre><code class="language-java">class Employee {
  private final String name;
  private final BigDecimal salary;

  public Employee(String name) {
    this.name = name;
    this.salary = calculateSalary(); 
  } 

  // slow operation
  static BigDecimal calculateSalary() { /* ... */ }

  // ...
}
</code></pre>
<p>Though, there is a design smell in the code snippet above. 
Namely, we should avoid performing heavy operations inside the constructor: 
<strong>the construction of the object should be rather fast</strong>.</p>
<h2 id="lomboks-lazy-magic">Lombok's "Lazy" Magic</h2>
<p>To ensure efficient salary calculation, one approach is to utilize 
Lombok's <code>@Getter(lazy = true)</code>.
<strong>This annotation provides a convenient way to calculate the salary only once 
and cache its value for future reference</strong>:</p>
<pre><code class="language-java">class Employee {
  private final String name;
  // constructor

  @Getter(lazy = true)
  private final BigDecimal salary = calculateSalary();

  // ...
}
</code></pre>
<p>Not only does this approach enhance performance, but it also improves the design of our code. 
By calculating the salary only when it is first accessed, instead of in the constructor, 
the code becomes more flexible and efficient:</p>
<pre><code class="language-java">@Test
void test() {
  log.info(&quot;test started&quot;);
  var employee = new Employee(&quot;john doe&quot;);
  log.info(&quot;employee created!&quot;);

  var s = employee.getSalary();
  log.info(&quot;salary retrieved: &quot; + s);

  s = employee.getSalary();
  log.info(&quot;salary retrieved: &quot; + s);

  s = employee.getSalary();
  log.info(&quot;salary retrieved: &quot; + s);
}
</code></pre>
<p>Assuming the <em>calculateSalary()</em> method involves I/O and takes a long time,
we'd want following behavior from our lazy getter:</p>
<ul>
<li>a fast constructor;</li>
<li>a slow initial evaluation of the salary;</li>
<li>fast subsequent evaluations;</li>
</ul>
<p><img alt="Lazy evaluation output" src="../../img/lombok_lazy_oop_1.png" /></p>
<p>As expected, the constructor is fast and the first retrieval of the salary is slow: 
after that, the value is cached and everything goes fast.</p>
<h2 id="the-oop-alternative">The O.O.P. Alternative</h2>
<p><strong>While the use of the lazy getter has its advantages, 
it also introduces an element of 'magic' into our code.</strong> </p>
<p>It's important to consider the trade-offs and weigh the benefits against the potential consequences. 
This time, we can achieve the same functionality by applying the "decorator" design pattern.</p>
<p>Firstly, let's revert to the initial version of the <em>Employee</em> class:</p>
<pre><code class="language-java">class Employee {
    private final String name;
    // constructor

    private BigDecimal getSalary() {
        return calculateSalary();
    }

    // slow operation
    static BigDecimal calculateSalary() { /* ... */ } 

    //...
}
</code></pre>
<p>Now, let's create a very simple implementation of an <em>EmployeeWithCachedSalary</em> class 
that extends <em>Employee</em> and wraps the original instance. 
We do not have a common interface to implement, and, for this simple use case, 
we won't overcomplicate the example:</p>
<pre><code class="language-java">class EmployeeWithCachedSalary extends Employee {
  private final AtomicReference&lt;BigDecimal&gt; cachedSalary = new AtomicReference&lt;&gt;();

  private final Employee delegate;
  // constructor

  @Override
  public BigDecimal getSalary() {
    return cachedSalary.updateAndGet(
        salary -&gt; salary != null 
          ? salary 
          : delegate.getSalary()
    );
  }

  // any other method calls will be delegated
  // to the decorated Employee instance:
  @Override
  public String getName() {
    return delegate.getName();
  }
}
</code></pre>
<p>As we can see, when overriding the <em>getSalary()</em> method,
we use an <em>AtomicReference<BigDecimal></em> to check if the salary has already been computed.</p>
<p><strong>This approach has the advantage of extracting the logic about caching the salary value
away from the <em>Employee</em> class</strong>, giving us more flexibility.</p>
<p>In order to use this decorator, we'll create a new instance of <em>EmployeeWithCachedSalary</em> 
wrapping the original <em>Employee</em> object:</p>
<pre><code class="language-java">@Test
void test() {
  log.info(&quot;test started&quot;);
  Employee employee = new EmployeeWithCachedSalary(new Employee());
  log.info(&quot;employee created!&quot;);

  BigDecimal salary = employee.getSalary();
  log.info(&quot;salary retrieved: &quot; + s);

  salary = employee.getSalary();
  log.info(&quot;salary retrieved: &quot; + s);

  salary = employee.getSalary();
  log.info(&quot;salary retrieved: &quot; + s);
}
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>In this short article, we delved into the <code>@Getter(lazy = true)</code> feature of Lombok, 
starting with a discussion on the issue it aims to address 
â€” the negative impacts of incorporating complex logic within constructors.</p>
<p>We then showcased how Lombok comes to the rescue, 
followed by a presentation of the object-oriented programming alternative, 
the Decorator Pattern.</p></p>
    </article>
</section>

  <!-- Newsletter Subscription -->
  <div style="margin-top: 3rem; padding: 2rem 7px; text-align: center;">
    <p style="margin-bottom: 1.5rem;">
      Subscribe to my monthly dev log.<br>
      Articles on writing code with intentionality.<br>
      No AI-generated fluff!
    </p>

    <form
      id="newsletter-form-footer"
      class="embeddable-buttondown-form"
      style="margin: 0 auto;"
    >
      <input type="email" name="email" class="bd-email-footer" placeholder="Enter your email" required />
      <input type="submit" value="Subscribe" />
    </form>
    <div id="newsletter-message-footer" style="display: none; margin-top: 10px; padding: 10px; border-radius: 6px;"></div>
  </div>

  <!-- ShareThis Buttons -->
  <div style="margin-top: 2rem; padding: 1rem 7px;">
    <div class="sop"></div>
  </div>

  <!-- Giscus Comments -->
  <div class="giscus-comments" style="padding-bottom: 2rem; padding-left: 7px; padding-right: 7px;">
    <script src="https://giscus.app/client.js"
            data-repo="etrandafir93/etrandafir93"
            data-repo-id="R_kgDOMA5rWQ"
            data-category="General"
            data-category-id="DIC_kwDOMA5rWc4C0Ujw"
            data-mapping="pathname"
            data-strict="1"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="catppuccin_frappe"
            data-lang="en"
            crossorigin="anonymous"
            async>
    </script>
  </div>

            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '../..';</script>
        <script src="../../assets/js/jquery-3.3.1.slim.min.js"></script>
        <script src="../../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../../assets/js/mkdocs.js"></script>
			<script src="https://platform-api.sharethis.com/js/sharethis.js#property=69519501707ebdefb2a2468e&product=sop&source=platform" defer></script>
			<script src="../../javascripts/newsletter.js" defer></script>
			<script src="../../search/main.js" defer></script>

</body>

</html>